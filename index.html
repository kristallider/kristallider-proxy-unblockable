<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kristallider Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0a0a0a; --card:#111; --accent:#00ff9d; --text:#f0f0f0; }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; overflow:hidden; }
    .container { max-width:1300px; margin:30px auto; background:var(--card); border-radius:24px; overflow:hidden; box-shadow:0 25px 80px rgba(0,255,157,0.12); border:1px solid rgba(0,255,157,0.1); }
    header { background:linear-gradient(135deg,#00ff9d,#00b37a); color:#000; padding:28px; text-align:center; font-size:2.2rem; font-weight:800; position:relative; }
    .logout { position:absolute; top:20px; right:25px; background:rgba(0,0,0,0.35); color:white; border:none; padding:10px 22px; border-radius:50px; font-weight:600; cursor:pointer; }
    .tabs { display:flex; background:#0c0c0c; flex-wrap:wrap; }
    .tab { flex:1 1 100px; padding:20px; text-align:center; font-weight:600; cursor:pointer; border-bottom:3px solid transparent; }
    .tab:hover { background:#1a1a1a; }
    .tab.active { background:#1a1a1a; color:var(--accent); border-bottom:3px solid var(--accent); }
    .content { padding:30px; min-height:75vh; }
    .tabcontent { display:none; animation:fade 0.4s; }
    .tabcontent.active { display:block; }
    @keyframes fade { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }

    /* ULTRAKILL */
    #ultrakill-container { position:relative; width:100%; height:760px; background:#000; border-radius:18px; overflow:hidden; }
    #ultrakill-canvas { width:100%; height:100%; }
    .fullscreen-btn { position:absolute; top:10px; right:10px; z-index:999; background:var(--accent); color:black; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; font-weight:bold; }

    /* Games Grid */
    .games-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; margin-top:20px; }
    .game-card { background:#151515; border-radius:16px; overflow:hidden; cursor:pointer; transition:0.3s; }
    .game-card:hover { transform:translateY(-8px); box-shadow:0 15px 30px rgba(0,255,157,0.2); }
    .game-card img { width:100%; height:160px; object-fit:cover; }
    .game-title { padding:15px; text-align:center; font-weight:600; }

    /* Chat */
    #chat { display:flex; flex-direction:column; height:720px; background:#0c0c0c; border-radius:18px; overflow:hidden; }
    #messages { flex:1; padding:20px; overflow-y:auto; }
    .msg { margin:8px 0; padding:12px 16px; border-radius:16px; max-width:80%; word-wrap:break-word; }
    .msg.self { background:var(--accent); color:#000; align-self:flex-end; margin-left:auto; }
    .msg.other { background:#222; align-self:flex-start; }
    .msg span { font-size:0.8rem; opacity:0.8; display:block; margin-top:4px; }
    #chatInputArea { display:flex; padding:15px; background:#111; gap:10px; }
    #chatInput { flex:1; padding:12px; background:#222; border:none; border-radius:12px; color:white; }
    #sendBtn, #shareScreenBtn { background:var(--accent); color:black; border:none; padding:0 20px; border-radius:12px; cursor:pointer; font-weight:bold; }

    /* Login */
    #loginScreen { position:fixed; inset:0; background:var(--bg); display:flex; align-items:center; justify-content:center; z-index:100; }
    .login-box { background:var(--card); padding:50px 60px; border-radius:24px; width:420px; text-align:center; box-shadow:0 30px 80px rgba(0,255,157,0.15); border:1px solid rgba(0,255,157,0.15); }
    .login-box h1 { font-size:4.5rem; font-weight:900; background:linear-gradient(135deg,#00ff9d,#00b37a); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:30px; }
    input { width:100%; padding:16px; margin:12px 0; background:#222; border:none; border-radius:12px; color:white; font-size:1.1rem; }
    button.login { width:100%; padding:16px; background:var(--accent); color:black; font-weight:700; font-size:1.2rem; border:none; border-radius:12px; cursor:pointer; margin-top:20px; }
    button.login:hover { transform:translateY(-4px); box-shadow:0 15px 30px rgba(0,255,157,0.4); }
    .error { color:#ff6b6b; margin:15px 0; font-weight:500; }
  </style>
</head>
<body id="body">

<!-- Login -->
<div id="loginScreen">
  <div class="login-box">
    <h1>LOGIN LOL</h1>
    <p id="errorMsg" class="error"></p>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button class="login" onclick="login()">Enter Portal</button>
    <br><br>
    <small style="color:#888">Accounts: Eddie • Billy • Rayyan • Aryan • kristallider (owner)</small>
  </div>
</div>

<!-- Portal -->
<div class="container" id="portal" style="display:none;">
  <header>
    Kristallider Portal
    <button class="logout" onclick="logout()">Logout</button>
  </header>

  <div class="tabs">
    <div class="tab active" onclick="openTab('proxy')">Proxy Main</div>
    <div class="tab" onclick="openTab('games')">Games</div>
    <div class="tab" onclick="openTab('chat')">Chat</div>
    <div class="tab" onclick="openTab('profile')">Profile</div>
    <div class="tab" id="adminTab" onclick="openTab('admin')">Admin Panel</div>
  </div>

  <div class="content">
    <!-- Proxy -->
    <div id="proxy" class="tabcontent active">
      <h2 style="color:var(--accent); margin-bottom:12px;">Scramjet Proxy</h2>
      <iframe src="https://holyunblocker.org/scramjet" width="100%" height="760" allowfullscreen sandbox="allow-scripts allow-same-origin allow-forms allow-modals allow-popups allow-top-navigation"></iframe>
    </div>

    <!-- GAMES TAB WITH ULTRAKILL -->
    <div id="games" class="tabcontent">
      <h2 style="color:var(--accent); margin-bottom:20px;">Unblocked Games</h2>
      <div class="games-grid">
        <!-- ULTRAKILL -->
        <div class="game-card" onclick="openUltrakill()">
          <img src="https://images.igdb.com/igdb/image/upload/t_cover_big/co4b7w.jpg" alt="ULTRAKILL">
          <div class="game-title">ULTRAKILL</div>
        </div>
        <div class="game-card" onclick="window.open('https://1v1.lol','_blank')"><img src="https://1v1.lol/assets/img/1v1lol.jpg" alt=""><div class="game-title">1v1.LOL</div></div>
        <div class="game-card" onclick="window.open('https://krunker.io','_blank')"><img src="https://krunker.io/static/images/krunker.jpg" alt=""><div class="game-title">Krunker.io</div></div>
        <div class="game-card" onclick="window.open('https://shellshock.io','_blank')"><img src="https://shellshock.io/static/img/thumbnail.jpg" alt=""><div class="game-title">Shell Shockers</div></div>
        <div class="game-card" onclick="window.open('https://slope-game.github.io','_blank')"><img src="https://slope-game.github.io/assets/img/slope.jpg" alt=""><div class="game-title">Slope</div></div>
        <div class="game-card" onclick="window.open('https://retrox.games','_blank')"><img src="https://retrox.games/assets/retro.jpg" alt=""><div class="game-title">Retro Bowl</div></div>
      </div>
    </div>

    <!-- ULTRAKILL FULLSCREEN MODAL -->
    <div id="ultrakill-modal" style="display:none; position:fixed; inset:0; background:#000; z-index:9999;">
      <button class="fullscreen-btn" onclick="toggleFullscreen()">Fullscreen</button>
      <button class="fullscreen-btn" style="right:60px;" onclick="closeUltrakill()">Close</button>
      <div id="ultrakill-container">
        <div id="loading-text" style="color:#00ff9d; font-size:48px; text-align:center; margin-top:200px;">LOADING ULTRAKILL...</div>
        <canvas id="ultrakill-canvas" tabindex="-1"></canvas>
      </div>
    </div>

    <!-- CHAT WITH SCREEN SHARE -->
    <div id="chat" class="tabcontent">
      <h2 style="color:var(--accent); margin-bottom:15px;">Squad Chat</h2>
      <div id="chatBox">
        <div id="messages"></div>
        <div id="chatInputArea">
          <input type="text" id="chatInput" placeholder="Type a message..." maxlength="200">
          <button id="sendBtn" onclick="sendMessage()">Send</button>
          <button id="shareScreenBtn" onclick="shareScreen()">Share Screen</button>
        </div>
      </div>
    </div>

    <!-- Profile & Admin -->
    <div id="profile" class="tabcontent">
      <h2 style="color:var(--accent); margin-bottom:20px;">Profile Settings</h2>
      <p>Welcome, <strong id="currentUsername"></strong>!</p>
      <button onclick="saveSettings()" class="save-settings">Save Settings</button>
    </div>

    <div id="admin" class="tabcontent">
      <h2 style="color:var(--accent);">Owner Admin Panel</h2>
      <table><thead><tr><th>User</th><th>Status</th><th>Actions</th></tr></thead><tbody id="userList"></tbody></table>
    </div>
  </div>
</div>

<script>
// === ULTRAKILL ===
function openUltrakill() {
  document.getElementById("ultrakill-modal").style.display = "block";
  loadUltrakill();
}

function closeUltrakill() {
  document.getElementById("ultrakill-modal").style.display = "none";
  document.getElementById("ultrakill-container").innerHTML = '<div id="loading-text" style="color:#00ff9d; font-size:48px; text-align:center; margin-top:200px;">LOADING ULTRAKILL...</div><canvas id="ultrakill-canvas" tabindex="-1"></canvas>';
}

function toggleFullscreen() {
  const elem = document.getElementById("ultrakill-modal");
  if (!document.fullscreenElement) {
    elem.requestFullscreen().catch(err => alert("Fullscreen failed: " + err));
  } else {
    document.exitFullscreen();
  }
}

function loadUltrakill() {
  const canvas = document.getElementById("ultrakill-canvas");
  const container = document.getElementById("ultrakill-container");
  canvas.width = container.clientWidth;
  canvas.height = container.clientHeight;

  const script = document.createElement("script");
  script.src = "https://cdn.jsdelivr.net/gh/genizy/web-port@latest/ultrakill/Build/ultrakill.loader.js";
  document.body.appendChild(script);

  script.onload = () => {
    createUnityInstance(canvas, {
      dataUrl: "https://cdn.jsdelivr.net/gh/genizy/web-port@latest/ultrakill/Build/ultrakill.data.unityweb",
      frameworkUrl: "https://cdn.jsdelivr.net/gh/genizy/web-port@latest/ultrakill/Build/ultrakill.framework.js.unityweb",
      codeUrl: "https://cdn.jsdelivr.net/gh/genizy/web-port@latest/ultrakill/Build/ultrakill.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "Hakita",
      productName: "ULTRAKILL",
      productVersion: "1.4",
    }).then(() => {
      document.getElementById("loading-text").remove();
    });
  };
}

// === SCREEN SHARE IN CHAT ===
let screenStream = null;
async function shareScreen() {
  if (screenStream) {
    screenStream.getTracks().forEach(t => t.stop());
    screenStream = null;
    alert("Stopped sharing screen");
    return;
  }
  try {
    screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
    const video = document.createElement("video");
    video.srcObject = screenStream;
    video.autoplay = true;
    video.style.width = "100%";
    video.style.borderRadius = "12px";
    video.style.margin = "10px 0";

    const msgDiv = document.createElement("div");
    msgDiv.className = "msg self";
    msgDiv.innerHTML = `<strong>${current} is sharing screen</strong><span>Live</span>`;
    msgDiv.appendChild(video);
    document.getElementById("messages").appendChild(msgDiv);
    document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;

    screenStream.getVideoTracks()[0].addEventListener("ended", () => {
      screenStream = null;
      alert("Screen sharing ended");
    });
  } catch (e) {
    alert("Screen share denied or failed");
  }
}

// === CHAT & REST OF PORTAL (same as before) ===
let messages = JSON.parse(localStorage.getItem("chatMessages") || "[]");
let current = null;

function sendMessage() {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text || !current) return;
  messages.push({ user: current, text, time: Date.now() });
  localStorage.setItem("chatMessages", JSON.stringify(messages));
  input.value = "";
  renderMessages();
}

function renderMessages() {
  const container = document.getElementById("messages");
  container.innerHTML = "";
  messages.forEach(m => {
    const div = document.createElement("div");
    div.className = `msg ${m.user === current ? "self" : "other"}`;
    div.innerHTML = `<strong style="color:${m.user==='kristallider'?'#ff0066':var(--accent)}">${m.user}</strong>: ${m.text}<span>${new Date(m.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>`;
    container.appendChild(div);
  });
  container.scrollTop = container.scrollHeight;
}

document.getElementById("chatInput")?.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

// Login, tabs, etc. (same logic)
function login() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value;
  const ACCOUNTS = { Eddie: "pizza123", Billy: "banana123", Rayyan: "pizza67", Aryan: "kebab", kristallider: "kristal2025" };
  if (!ACCOUNTS[u] || ACCOUNTS[u] !== p) return alert("Wrong username or password");

  current = u;
  document.getElementById("loginScreen").style.display = "none";
  document.getElementById("portal").style.display = "block";
  document.getElementById("currentUsername").textContent = u;
  document.getElementById("adminTab").style.display = (u === "kristallider") ? "block" : "none";
  openTab("proxy");
  renderMessages();
}

function openTab(t) {
  document.querySelectorAll(".tabcontent").forEach(e=>e.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
  document.getElementById(t).classList.add("active");
  document.querySelector(`.tab[onclick="openTab('${t}')"]`).classList.add("active");
  if (t==="chat") renderMessages();
}

function logout() {
  current = null;
  document.getElementById("portal").style.display = "none";
  document.getElementById("loginScreen").style.display = "flex";
}
</script>
</body>
</html>
